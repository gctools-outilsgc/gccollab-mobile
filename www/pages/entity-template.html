<template>
    <div class="page navbar-fixed">
        <div class="navbar">
            <div class="navbar-inner">
                <div id="entity-{{guid}}-navbar-inner" class="navbar-inner" role="navigation" data-translate-target="aria-label" data-translate="navigation-bar">
                    {{navbar}}
                </div>
            </div>
        </div>

            <div class="toolbar toolbar-bottom-md">
                <div class="toolbar-inner">
                    <div class="left sliding"><a href="#" class="link back" aria-label="Back Button"><i class="far fa-arrow-alt-circle-left fa-2x"></i></a></div>
                </div>
            </div>

            <div class="page-content" style="overflow-x: hidden;">
                <div id="content-entity-{{guid}}" class='list cards-list'></div>
                {{#js_if "this.comments"}}
                <div id="comment-card-{{guid}}">
                    <div class="content-block comment">
                        <div class="content-block-inner comment">
                            <div class="row no-gutter">
                                <div class="col">
                                    <div id="comment-count-{{guid}}" class="left number-comment" data-translate="comments">comments:</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="list">
                    <ul class="message-comment">
                        <li class="align-top">
                            <div class="item-content">
                                <div class="item-inner">
                                    <div class="item-input">
                                        <textarea id="message-{{guid}}" class="comment-textarea" data-translate-target="placeholder" data-translate="write-comment" placeholder="write a comment"></textarea>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="content-block"> <a id="comments-submit-{{guid}}" class="button button-big button-fill" data-translate="comment">Comment</a> </li>
                        <li class="content-block"><a id="comments-view-{{guid}}" class="button button-big button-fill" data-translate="view-comments">VIEW COMMENTS</a></li>
                    </ul>
                </div>
                <div id="comment-head" class="list media-list comment">
                    <ul id="entity-comments-{{guid}}" class="comment"></ul>
                    <a id="comments-more-{{guid}}" class="button button-big button-fill" data-translate="view-more">VIEW MORE</a>
                </div>
                {{/js_if}}
            </div>
        </div>
</template>
<script>
    return {
        on: {
            pageInit: function (e, page) {
                var guid = this.guid;
                var type = this.type;
                var each = this.each;
                var limit = 10;
                var offset = 0;
                console.log(guid + ' ' + type);

                
                switch (type) {
                    case 'wire':
                        GCTrequests.GetWire(guid, 1, function (data) {
                            var wires = data.result.reverse();
                            var content = "";
                            $(wires).each(function (key, value) {
                                // Removes HTML components from Blog
                                // var text = $(value.description).text();
                                var text = value.description;

                                var source = "";
                                if (value.shareText && value.shareURL) {
                                    source = "<blockquote>" + GCTLang.Trans("source") + " <a onclick='GCT.FireLink(this);' data-type='gccollab_wire_post' href='" + value.shareURL + "'>" + value.shareText + "</a></blockquote>";
                                } else if (value.shareURL) {
                                    source = "<blockquote>" + GCTLang.Trans("source") + " <a onclick='GCT.FireLink(this);' data-type='gccollab_wire_post' href='" + value.shareURL + "'>" + text + "</a></blockquote>";
                                }
                                var img = '';
                                var img = '';
                                if (value.attachment) {
                                    img = "<img class='WireImage' onclick='ShowImage(this)' id='image-" + value.guid + "' src='https://gccollab.ca/thewire_image/download/" + value.attachment.guid + "' style='' />";
                                }

                                var replied = (value.replied) ? "replied" : "";
                                var liked = (value.liked) ? "liked" : "";
                                var likes = (value.likes > 0) ? value.likes + (value.likes == 1 ? GCTLang.Trans("like") : GCTLang.Trans("likes")) : GCTLang.Trans("like");
                                var action = '';

                                content += GCTtxt.txtWire({
                                    guid: value.guid,
                                    icon: value.userDetails.iconURL,
                                    name: value.userDetails.displayName,
                                    date: prettyDate(value.time_created),
                                    description: text,
                                    source: source,
                                    type: "gccollab_wire_post",
                                    replied: replied,
                                    action: action,
                                    owner: value.owner_guid,
                                    liked: liked,
                                    likes: likes,
                                    image: img
                                });
                            });
                            $(content).hide().appendTo('#content-entity-'+guid).fadeIn(500);
                        });
                        break;
                    case 'blog':
                        GCTrequests.GetBlog(guid, function (data) {
                            var blog = data.result;
                            var content = "";
                            $(blog).each(function (key, value) {
                                // Removes HTML components from Blog
                                var text = (value.description !== null) ? value.description : "";
                                if (value.groupURL.indexOf("/groups/profile/") > -1) {
                                    var group = GCTLang.Trans("posted-group") + " <a onclick='GCT.FireLink(this);' data-type='gccollab_group' href='" + value.groupURL + "'>" + value.group + "</a>";
                                } else {
                                    var group = GCTLang.Trans("posted-user") + " <a onclick='ShowProfile(" + value.owner_guid + ")' >" + value.userDetails.displayName + "</a>";
                                }
                                var replied = (value.replied) ? "replied" : "";
                                var liked = (value.liked) ? "liked" : "";
                                var likes = (value.likes > 0) ? value.likes + (value.likes == 1 ? GCTLang.Trans("like") : GCTLang.Trans("likes")) : GCTLang.Trans("like");
                                var action = " <a class='link' onclick='GCT.SiteLink(this);' data-type='gccollab_blog_post' href='" + value.url + "'>" + GCTLang.Trans("web-view") + "</a>";

                                content += GCTtxt.txtBlog({
                                    icon: value.userDetails.iconURL,
                                    name: value.userDetails.displayName,
                                    date: prettyDate(value.time_created),
                                    group: group,
                                    description: text,
                                    title: value.title,
                                    all_text: "all_text",
                                    action: action,
                                    owner: value.owner_guid,
                                    guid: value.guid,
                                    type: "gccollab_blog_post",
                                    replied: replied,
                                    liked: liked,
                                    likes: likes
                                });
                            });

                            $(content).hide().appendTo('#content-entity-' + guid).fadeIn(500);
                        });
                        break;
                    default:
                        break;
                }
            },

           
        }
    }
</script>