<template>
    <div class="page navbar-fixed with-subnavbar">
        <div class="navbar">
            <div class="navbar-inner">
                <div id="{{id}}-navbar-inner" class="navbar-inner" role="navigation" data-translate-target="aria-label" data-translate="navigation-bar">
                    {{navbar}}
                </div>
                <div class="subnavbar" role="navigation" data-translate-target="aria-label">
                    <div class="subnavbar-inner">
                        <div class="segmented">
                            {{#each tabs}}
                            <a href="#{{../id}}-{{this.id}}" class="button tab-link {{#if @first}}tab-link-active{{/if}} tab-link" data-translate="{{this.id}}"></a>
                            {{/each}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="toolbar toolbar-bottom-md" role="navigation" data-translate-target="aria-label" data-translate="toolbar">
            <div class="toolbar-inner">
                <div class="left sliding"><a href="#" class="link back" aria-label="Back Button"><i class="far fa-arrow-alt-circle-left fa-2x"></i></a></div>
            </div>
        </div>

        <div class="page-content with-subnavbar">
            <div id="{{id}}-Feedback"></div>
            <div class="tabs">
                {{#each tabs}}
                <div id="{{../id}}-{{this.id}}" class="tab {{#if @first}}tab-active{{/if}}">
                    <form id="{{this.id}}-form" class="list">
                        <ul>
                            <li>
                                <div class="item-content item-input">
                                    <div class="item-inner">
                                        <div id="{{this.id}}-title-label" class="item-title item-label" data-translate="{{this.id}}-title"></div>
                                        <div class="item-input-wrap">
                                            <input id="{{this.id}}-title" name="{{this.id}}-title" type="text" placeholder="" aria-labelledby="{{this.id}}-title-label" />
                                        </div>
                                    </div>
                                </div>
                            </li>
                            {{#js_if "../type === 'blog'"}}
                            <li>
                                <div class="item-content item-input">
                                    <div class="item-inner">
                                        <div id="{{this.id}}-excerpt-label" class="item-title item-label" data-translate="{{this.id}}-excerpt"></div>
                                        <div class="item-input-wrap">
                                            <input id="{{this.id}}-excerpt" name="{{this.id}}-excerpt" type="text" placeholder="" aria-labelledby="{{this.id}}-excerpt-label" />
                                        </div>
                                    </div>
                                </div>
                            </li>
                            {{/js_if}}
                            <li>
                                <div class="item-content item-input">
                                    <div class="item-inner">
                                        {{#js_if "../type === 'blog' || ../type === 'event' "}}
                                        <div id="{{this.id}}-body-label" class="item-title item-label" data-translate="{{this.id}}-body"></div>
                                        <div class="item-input-wrap">
                                            <textarea id="{{this.id}}-body-textarea" class="resizable" aria-labelledby="{{this.id}}-body-label"></textarea>
                                        </div>
                                        {{/js_if}}
                                        {{#js_if "../type === 'discussion'"}}
                                        <div id="{{this.id}}-body-label" class="item-title item-label" data-translate="{{this.id}}-topic"></div>
                                        <div class="item-input-wrap">
                                            <textarea id="{{this.id}}-body-textarea" class="resizable" aria-labelledby="{{this.id}}-body-label"></textarea>
                                        </div>
                                        {{/js_if}}
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </form>
                </div>
                {{/each}}
                <form id="{{id}}-options-form" class="list">
                    <ul>
                        {{#js_if "../type === 'event'"}}
                        <li>
                            <div class="item-content item-input">
                                <div class="item-inner">
                                    <div id="venue-label" class="item-venue item-input" data-translate="event-venue">Location</div>
                                    <div class="item-input-wrap">
                                        <input id="venue" name="venue" type="text" placeholder="" aria-labelledby="venue-label" />
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content item-input">
                                <div class="item-inner">
                                    <div id="room-label" class="item-room item-input" data-translate="event-room">Room</div>
                                    <div class="item-input-wrap">
                                        <input id="room" name="room" type="text" placeholder="" aria-labelledby="room-label" />
                                    </div>
                                </div>
                            </div>
                        </li>

                        <li>
                            <div class="block-title" data-translate="schedule">Title</div>
                        </li>
                        <li>
                            <label class="item-checkbox item-content" id="toggle_day">
                                <input type="checkbox" id="all-day" name="all-day" value="all_day" />
                                <i class="icon icon-checkbox"></i>
                                <div class="item-inner">
                                    <div class="item-title" data-translate="all-day-event"></div>
                                </div>
                            </label>
                        </li>
                        <li>
                            <div class="item-content item-input">
                                <div class="item-inner">
                                    <div class="item-title item-label" data-translate="startdate"></div>
                                    <div class="item-input-wrap">
                                        <input type="date" name="startdate" id="events-startdate" placeholder="" value="">
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content item-input starttime">
                                <div class="item-inner">
                                    <div class="item-title item-label" data-translate="starttime">Start time</div>
                                    <div class="item-input-wrap">
                                        <input type="time" id="starttime">
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content item-input">
                                <div class="item-inner">
                                    <div class="item-title item-label" data-translate="enddate"></div>
                                    <div class="item-input-wrap">
                                        <input type="date" name="startdate" id="events-enddate" placeholder="" value="">
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content item-input endtime">
                                <div class="item-inner">
                                    <div class="item-title item-label" data-translate="endtime">End time</div>
                                    <div class="item-input-wrap">
                                        <input type="time" placeholder="00:00:00" id="endtime">
                                    </div>
                                </div>
                            </div>
                        </li>

                        <li>
                            <div class="block-title" data-translate="meeting-conf-title">Title</div>
                        </li>
                        <li>
                            <label class="item-checkbox item-content" id="toggle_conference">
                                <input type="checkbox" id="web_conference" name="web_conference" value="1" />
                                <i class="icon icon-checkbox"></i>
                                <div class="item-inner">
                                    <div class="item-title" data-translate="event-web-conference"></div>
                                </div>
                            </label>
                        </li>
                        <li>
                            <div class="item-content url item-input" style="display: none;">
                                <div class="item-inner">
                                    <div id="teleconference-label" class="item-teleconference item-label" data-translate="teleconference-url">URL</div>
                                    <div class="item-input-wrap">
                                        <input id="teleconference_text" name="teleconference_text" type="text" placeholder="" aria-labelledby="teleconference-label" />
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content item-input additionnal" style="display: none;">
                                <div class="item-inner">
                                    <div id="additionnal-label" class="item-additionnal item-label" data-translate="additionnal-body">Additionnal information</div>
                                    <div class="item-input-wrap">
                                        <textarea id="additionnal-body-textarea" class="resizable" aria-labelledby="additionnal-body-label"></textarea>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content item-input">
                                <div class="item-inner">
                                    <div id="fees-label" class="item-fees item-title item-label" data-translate="teleconference-fees">Fees</div>
                                    <div class="item-input-wrap">
                                        <input id="fees_text" name="fees_text" type="text" placeholder="" aria-labelledby="fees-label" />
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content item-input">
                                <div class="item-inner">
                                    <div class="item-title item-label" data-translate="event-language"></div>
                                    <div class="item-input-wrap">
                                        <select id="picker-language" name="picker-language">
                                            <option data-translate="bilingual"></option>
                                            <option data-translate="english"></option>
                                            <option data-translate="french"></option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <label class="item-checkbox item-content" id="toggle_contact">
                                <input type="checkbox" id="contact_checkbox" name="contact_checkbox" value="1" />
                                <i class="icon icon-checkbox"></i>
                                <div class="item-inner">
                                    <div class="item-title" data-translate="not-contact"></div>
                                </div>
                            </label>
                        </li>
                        <li>
                            <div class="item-content contact item-input" style="display: none;">
                                <div class="item-inner">
                                    <div id="contact-label" class="item-contact item-label" data-translate="event-contact">Contact</div>
                                    <div class="item-input-wrap">
                                        <input id="contact_text" name="contact_text" type="text" placeholder="" aria-labelledby="contact-label" />
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content contact_email item-input" style="display: none;">
                                <div class="item-inner">
                                    <div id="contact_email-label" class="item-contact_email item-label" data-translate="contact_email">E-mail address</div>
                                    <div class="item-input-wrap">
                                        <input id="contact_email_text" name="contact_email_text" type="text" placeholder="" aria-labelledby="contact_email-label" />
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content contact_phone item-input" style="display: none;">
                                <div class="item-inner">
                                    <div id="contact_phone-label" class="item-contact_phone item-label" data-translate="contact_phone">Phone number</div>
                                    <div class="item-input-wrap">
                                        <input id="contact_phone_text" name="contact_phone_text" type="text" placeholder="" aria-labelledby="contact_phone-label" />
                                    </div>
                                </div>
                            </div>
                        </li>
                        {{/js_if}}
                        <li>
                            <div class="item-content item-input">
                                <div class="item-inner">
                                    {{#js_if "../type === 'blog' || ../type === 'event' "}}
                                    <div id="comment-label" class="item-title item-label" data-translate="comments"></div>
                                    <div class="item-input">
                                        <select id="{{id}}-comments" name="comments" aria-labelledby="comment-label">
                                            <option value="1" data-translate="on"></option>
                                            <option value="0" data-translate="off"></option>
                                        </select>
                                    </div>
                                    {{/js_if}}
                                    {{#js_if "../type === 'discussion'"}}
                                    <div id="status-label" class="item-title label" data-translate="status">Status</div>
                                    <div class="item-input">
                                        <select id="{{id}}-status" name="comments" aria-labelledby="status-label">
                                            <option value="1" data-translate="open">Open</option>
                                            <option value="0" data-translate="closed">Closed</option>
                                        </select>
                                    </div>
                                    {{/js_if}}
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content item-input">
                                <div class="item-inner">
                                    <div id="access-label" class="item-title item-label" data-translate="access">Access</div>
                                    <div class="item-input">
                                        <select id="{{id}}-access" name="access" aria-labelledby="access-label">
                                            <option value="0" data-translate="only-me">Only Me</option>
                                            {{#js_if "!this.group"}}
                                            <option value="-2" id="{{id}}-Colleague" data-translate="only-colleagues">My Colleagues on GCcollab Only</option> {{/js_if}}
                                            {{#js_if "this.group"}}
                                            <option value="2" id="{{id}}-Group" data-translate="only-group">Group Members Only</option> {{/js_if}}
                                            {{#js_if "../public != 'false'"}}
                                            <option value="1" id="{{id}}-public" data-translate="only-logged">Logged in users on GCcollab Only</option>{{/js_if}}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {{#js_if "../type === 'blog' || ../type === 'event' "}}
                        <li>
                            <div class="item-content item-input">
                                <div class="item-inner">
                                    <div id="status-label" class="item-title item-label" data-translate="status"></div>
                                    <div class="item-input">
                                        <select id="{{id}}-status" name="status" aria-labelledby="status-label">
                                            <option value="1" data-translate="published">Published</option>
                                            <option value="0" data-translate="draft">Draft</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {{/js_if}}
                    </ul>
                    <div class="block">
                        <div class="row">
                            <a id="submit-{{id}}" class="col button button-big button-fill" data-translate="{{id}}"></a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</template>
<script>
    return {
        on: {
            pageInit: function (e, page) {
                var action = this.action || '';
                var group = this.group || '';
                var id = this.id || '';
                var guid = this.guid || '';
                var type = this.type || '';

                if (type === 'blog') {
                    $$('#submit-' + id).on('click', function (e) {
                        $$('#' + id + '-Feedback').html(''); //clears feedback message on new submit
                        var title = {}, excerpt = {}, body = {};
                        title.en = $('#english-title').val();
                        title.fr = $('#french-title').val();
                        excerpt.en = $('#english-excerpt').val();
                        excerpt.fr = $('#french-excerpt').val();
                        body.en = $('#english-body-textarea').val();
                        body.fr = $('#french-body-textarea').val();
                        var comment = $('#' + id + '-comments').val();
                        var access = $('#' + id + '-access').val();
                        var status = $('#' + id + '-status').val();
                        //(container, title, excerpt, body, comments, access, successCallback, errorCallback)
                        GCTrequests.PostBlog(group, guid, title, excerpt, body, comment, access, status, function (data) {
                            if (data.result.indexOf("gccollab.ca/blog/view/") > -1) {
                                var obj = [];
                                obj.href = data.result;
                                GCT.FireLink(obj);
                            } else {
                                alert(data.result);
                            }
                        }, function (jqXHR, textStatus, errorThrown) {
                            console.log(jqXHR, textStatus, errorThrown);
                        }, function (feedback) {
                            var feedbackmsg = '<p class="item-content" style="padding-top: 0;padding-bottom: 0;" id="' + id + '-FeedbackMsg">' + GCTLang.Trans('issue') + feedback + '</p>';
                            $(feedbackmsg).hide().appendTo('#' + id + '-Feedback').fadeIn(500);
                            $('#' + id + '-FeedbackMsg').focus();
                        });
                    });
                    if (action === 'edit') {
                        GCTrequests.GetBlogEdit(guid, function (data) {
                            var blog = data.result;
                            if (blog.group) {
                                group = blog.container_guid; // Set group guid
                                $$('#' + id + '-Colleague').remove(); // If group container, remove colleague access option
                                if (blog.group.public == false) { $$('#' + id + '-public').remove(); } // if not a public group, no all logged access
                            } else {
                                $$('#' + id + '-Group').remove(); //If not container, remove group access option
                            }
                            $$('input#english-title').val(blog.title.en);
                            $$('input#french-title').val(blog.title.fr);
                            if (blog.excerpt) {
                                $$('#french-excerpt').val(blog.excerpt.fr);
                                $$('#english-excerpt').val(blog.excerpt.en);
                            }
                            $$('#english-body-textarea').val(blog.description.en);
                            $$('#french-body-textarea').val(blog.description.fr);

                        }, function (jqXHR, textStatus, errorThrown) {
                            console.log(jqXHR, textStatus, errorThrown);
                        });
                    }
                }

                if (type === 'discussion') {
                    $$('#submit-' + id).on('click', function (e) {
                        $$('#' + id + '-Feedback').html(''); //clears feedback message on new submit
                        var title = {}, message = {};
                        title.en = $('#english-title').val();
                        title.fr = $('#french-title').val();
                        message.en = $('#english-body-textarea').val();
                        message.fr = $('#french-body-textarea').val();
                        var status = $('#PostDiscussion-status').val();
                        var access = $('#PostDiscussion-access').val();

                        GCTrequests.PostDiscussion(group, guid, title, message, status, access, function (data) {
                            if (data.result.indexOf("gccollab.ca/discussion/view/") > -1) {
                                var obj = [];
                                obj.href = data.result;
                                GCT.FireLink(obj);
                            } else {
                                alert(data.result);
                            }
                        }, function (jqXHR, textStatus, errorThrown) {
                            console.log(jqXHR, textStatus, errorThrown);
                        }, function (feedback) {
                            var feedbackmsg = '<p class="card-content-inner" style="padding-top: 0;padding-bottom: 0;" id="' + id + '-FeedbackMsg">' + GCTLang.Trans('issue') + feedback + '</p>';
                            $(feedbackmsg).hide().appendTo('#' + id + '-Feedback').fadeIn(500);
                            $('#' + id + '-FeedbackMsg').focus();
                        });

                    });
                    if (action === 'edit') {
                        GCTrequests.GetDiscussionEdit(guid, function (data) {
                            var discussion = data.result;
                            group = discussion.container_guid;
                            $$('input#english-title').val(discussion.title.en);
                            $$('input#french-title').val(discussion.title.fr);
                            $$('#english-body-textarea').val(discussion.description.en);
                            $$('#french-body-textarea').val(discussion.description.fr);
                            if (!discussion.group.public) { $$('#' + id + '-public').remove(); }
                        }, function (jqXHR, textStatus, errorThrown) {
                            console.log(jqXHR, textStatus, errorThrown);
                        });
                    }
                }

                if (type === 'event') {
                    $$('#submit-' + id).on('click', function (e) {
                        $$('#' + id + '-Feedback').html(''); //clears feedback message on new submit
                        var title = {}, body = {};
                        title.en = $('#english-title').val();
                        title.fr = $('#french-title').val();
                        body.en = $('#english-body-textarea').val();
                        body.fr = $('#french-body-textarea').val();
                        var comment = $('#' + id + '-comments').val();
                        var access = $('#' + id + '-access').val();
                        var status = $('#' + id + '-status').val();
                        var allday = $('#all-day').prop('checked');
                        var starttime = $('#starttime').val();
                        var endtime = $('#endtime').val();
                        if (allday) {
                            allday = 'all_day';
                            starttime = '';
                            endtime = '';
                        }
                        var startdate = $('#events-startdate').val();
                        var enddate = $('#events-enddate').val();
                        var venue = $('#venue').val();
                        var room = $('#room').val();
                        var web_conference = $('#web_conference').prop('checked');
                        var url = $('#teleconference_text').val();
                        var additionnal = $('#additionnal-body-textarea').val();
                        if (!web_conference) {
                            url = '';
                            additionnal = '';
                        }
                        var fees = $('#fees_text').val();
                        var contact_checkbox = $('#contact_checkbox').prop('checked');
                        var contact_text = $('#contact_text').val();
                        var contact_email_text = $('#contact_email_text').val();
                        var contact_phone_text = $('#contact_phone_text').val();
                        if (!contact_checkbox) {
                            contact_text = '';
                            contact_email_text = '';
                            contact_phone_text = '';
                        }
                        var picker_language = $('#picker-language').val();
                        GCTrequests.PostEvent('', '', title, body, startdate, starttime, enddate, endtime, venue, room, allday, web_conference, url, additionnal, fees, contact_checkbox, contact_text, contact_email_text, contact_phone_text, picker_language, comment, access, status, function (data) {
                            alert(data.result);
                        }, function (jqXHR, textStatus, errorThrown) {
                            console.log(jqXHR, textStatus, errorThrown);
                        }, function (feedback) {
                            var feedbackmsg = '<p class="item-content" style="padding-top: 0;padding-bottom: 0;" id="' + id + '-FeedbackMsg">' + GCTLang.Trans('issue') + feedback + '</p>';
                            $(feedbackmsg).hide().appendTo('#' + id + '-Feedback').fadeIn(500);
                            $('#' + id + '-FeedbackMsg').focus();
                        });
                    });
                    $$('#toggle_day').on('click', function (e) {
                        $('.starttime').toggle();
                        $('.endtime').toggle();
                    });
                    $$('#toggle_conference').on('click', function (e) {
                        $('.additionnal').toggle();
                        $('.url').toggle();
                    });
                    $$('#toggle_contact').on('click', function (e) {
                        $('.contact_email').toggle();
                        $('.contact').toggle();
                        $('.contact_phone').toggle();
                    });
                }
                $$('#refresh-' + id).on('click', function (e) {
                    document.getElementById(id + '-options-form').reset();
                    document.getElementById('english-form').reset();
                    document.getElementById('french-form').reset();
                    $("#" + id + "-Feedback").html('');
                });
            }
        }
    }
</script>